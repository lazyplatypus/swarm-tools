{"id":"opencode-swarm-monorepo-lf2p4u-mjenx80mqiv","title":"Fix memory test infrastructure - shared test utilities","description":"Two issues causing 53 test failures:\n\n1. **Missing vector index in plugin tests** - Plugin tests manually create memory table but skip the vector index, causing `vector_top_k` to fail with \"failed to parse vector index parameters\"\n\n2. **PGLite legacy migration errors** - Tests try to read non-existent `/packages/swarm-mail/dist/pglite.data` during auto-migration checks\n\nRoot cause: Each test file has its own setup code instead of using shared utilities. swarm-mail has proper setup in adapter.test.ts but plugin tests don't use it.\n\nSolution: Create shared test utilities in swarm-mail that plugin can import, ensuring consistent schema setup everywhere.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T18:59:42.166Z","updated_at":"2025-12-20T19:39:37.357Z","closed_at":"2025-12-20T19:39:37.357Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjenx80qhqn","title":"Create createTestMemoryDb utility in swarm-mail","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T18:59:42.170Z","updated_at":"2025-12-20T19:23:08.838Z","closed_at":"2025-12-20T19:23:08.838Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjenx80mqiv","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjenx80s0n5","title":"Update plugin memory tests to use shared utility","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T18:59:42.172Z","updated_at":"2025-12-20T19:23:11.903Z","closed_at":"2025-12-20T19:23:11.903Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjenx80mqiv","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjenx80ue06","title":"Fix legacy migration to handle missing PGLite gracefully","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T18:59:42.174Z","updated_at":"2025-12-20T19:23:10.150Z","closed_at":"2025-12-20T19:23:10.150Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjenx80mqiv","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjeoros5h9c","title":"Use dynamic import for PGLite in migrate-legacy.ts to avoid WASM loading at module import","description":"The migrate-legacy.ts file has static imports for PGLite:\n```typescript\nimport { PGlite } from \"@electric-sql/pglite\";\nimport { vector } from \"@electric-sql/pglite/vector\";\n```\n\nThis causes WASM files to be loaded at module import time, even if PGLite is never used. When the bundled dist doesn't have the WASM files, it throws:\n```\nENOENT: no such file or directory, open '.../dist/pglite.data'\n```\n\nFix: Change to dynamic imports inside the functions that actually use PGLite:\n```typescript\nconst { PGlite } = await import(\"@electric-sql/pglite\");\nconst { vector } = await import(\"@electric-sql/pglite/vector\");\n```\n\nThis way PGLite only loads when migrateLegacyMemories() is actually called with a valid legacy database.\n\nFiles: packages/swarm-mail/src/memory/migrate-legacy.ts","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-20T19:23:23.573Z","updated_at":"2025-12-20T19:32:37.161Z","closed_at":"2025-12-20T19:32:37.161Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjenx80mqiv","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjep3tgo8x9","title":"Remove PGLite re-export from swarm-mail index.ts or make streams use dynamic imports","description":"The main index.ts has `export * from \"./streams\"` which re-exports everything from streams/index.ts, including static PGLite imports.\n\nstreams/index.ts has:\n```typescript\nimport { PGlite } from \"@electric-sql/pglite\";\nimport { vector } from \"@electric-sql/pglite/vector\";\n// ...\nexport { PGlite };\n```\n\nThis causes WASM files to load when swarm-mail is imported, even if PGLite is never used.\n\nOptions:\n1. Remove `export * from \"./streams\"` from index.ts and only export specific needed items\n2. Make streams/index.ts use dynamic imports like migrate-legacy.ts\n3. Create a separate entry point for PGLite-based code\n\nThe streams module appears to be legacy PGLite code that's been superseded by libSQL. We should probably just stop re-exporting it.\n\nFiles: packages/swarm-mail/src/index.ts, packages/swarm-mail/src/streams/index.ts","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-20T19:32:49.512Z","updated_at":"2025-12-20T19:39:34.786Z","closed_at":"2025-12-20T19:39:34.786Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjenx80mqiv","dependencies":[],"labels":[],"comments":[]}
